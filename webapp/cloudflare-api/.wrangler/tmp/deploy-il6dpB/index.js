var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// src/data/grace-data.ts
var graceData = [
  { date: "2002-03-31", groundwater_cm: 4.984614313908533 },
  { date: "2002-04-30", groundwater_cm: 5.814754618547283 },
  { date: "2002-07-31", groundwater_cm: 0.04867335719042135 },
  { date: "2002-08-31", groundwater_cm: 3.4341562103880725 },
  { date: "2002-09-30", groundwater_cm: 2.7963370185448664 },
  { date: "2002-10-31", groundwater_cm: -1.943450598589612 },
  { date: "2002-11-30", groundwater_cm: -0.9179619052107035 },
  { date: "2002-12-31", groundwater_cm: 0.3525057389556452 },
  { date: "2003-01-31", groundwater_cm: 1.2583555383986145 },
  { date: "2003-02-28", groundwater_cm: 4.109651624182988 },
  { date: "2003-03-31", groundwater_cm: 3.9457885578020537 },
  { date: "2003-04-30", groundwater_cm: 3.530293600607493 },
  { date: "2003-06-30", groundwater_cm: 3.633617013447585 },
  { date: "2003-07-31", groundwater_cm: 4.927979050740946 },
  { date: "2003-08-31", groundwater_cm: 6.564707278256534 },
  { date: "2003-09-30", groundwater_cm: 3.6247659044735503 },
  { date: "2003-10-31", groundwater_cm: 0.8487655760876968 },
  { date: "2003-11-30", groundwater_cm: 1.4311141300690275 },
  { date: "2003-12-31", groundwater_cm: 1.6091748219724549 },
  { date: "2004-02-03", groundwater_cm: 3.8620668756580137 },
  { date: "2004-02-29", groundwater_cm: 1.371405022262901 },
  { date: "2004-03-31", groundwater_cm: 1.1592015511612779 },
  { date: "2004-04-30", groundwater_cm: -0.23651522992060628 },
  { date: "2004-05-31", groundwater_cm: -2.8196802600799873 },
  { date: "2004-06-30", groundwater_cm: -0.49557020487521675 },
  { date: "2004-07-31", groundwater_cm: 2.207392992430363 },
  { date: "2004-08-31", groundwater_cm: 0.4968848989210752 },
  { date: "2004-09-30", groundwater_cm: -3.018718734085905 },
  { date: "2004-10-31", groundwater_cm: -1.6694442958561118 },
  { date: "2004-11-30", groundwater_cm: -2.4076644887208785 },
  { date: "2004-12-31", groundwater_cm: -0.9378220695844093 },
  { date: "2005-01-31", groundwater_cm: 3.7033275767280815 },
  { date: "2005-02-28", groundwater_cm: 7.04170763247604 },
  { date: "2005-03-31", groundwater_cm: 6.653607362039187 },
  { date: "2005-04-30", groundwater_cm: 6.836284842135034 },
  { date: "2005-05-31", groundwater_cm: 4.874063497458767 },
  { date: "2005-06-30", groundwater_cm: 5.1123189705864815 },
  { date: "2005-07-31", groundwater_cm: 5.30146427334633 },
  { date: "2005-08-31", groundwater_cm: 3.7126527839358534 },
  { date: "2005-09-30", groundwater_cm: 1.038332432600258 },
  { date: "2005-10-31", groundwater_cm: -0.1648691690822474 },
  { date: "2005-11-30", groundwater_cm: -1.115706520033963 },
  { date: "2005-12-31", groundwater_cm: -0.16479472317899632 },
  { date: "2006-01-31", groundwater_cm: 0.5208047221864563 },
  { date: "2006-02-28", groundwater_cm: 2.3433087262818613 },
  { date: "2006-03-31", groundwater_cm: 2.0487647401622997 },
  { date: "2006-04-30", groundwater_cm: -0.8291566040514987 },
  { date: "2006-05-31", groundwater_cm: -1.363961944698838 },
  { date: "2006-06-30", groundwater_cm: -1.728865899320971 },
  { date: "2006-07-31", groundwater_cm: 3.535214383297798 },
  { date: "2006-08-31", groundwater_cm: 2.962755135262621 },
  { date: "2006-09-30", groundwater_cm: -1.1126992595902963 },
  { date: "2006-10-31", groundwater_cm: -0.6079972250710521 },
  { date: "2006-11-30", groundwater_cm: 2.037439884362653 },
  { date: "2006-12-31", groundwater_cm: 1.614756143518921 },
  { date: "2007-01-31", groundwater_cm: 2.4564097452102382 },
  { date: "2007-02-28", groundwater_cm: 6.424655877557764 },
  { date: "2007-03-31", groundwater_cm: 5.0191150326681155 },
  { date: "2007-04-30", groundwater_cm: 2.564925451786195 },
  { date: "2007-05-31", groundwater_cm: 1.2506733741812959 },
  { date: "2007-06-30", groundwater_cm: 3.9544648826972146 },
  { date: "2007-07-31", groundwater_cm: 3.596024739645588 },
  { date: "2007-08-31", groundwater_cm: 2.4429253946665304 },
  { date: "2007-09-30", groundwater_cm: -1.3924494341661557 },
  { date: "2007-10-31", groundwater_cm: -3.3367988846100682 },
  { date: "2007-11-30", groundwater_cm: -5.1275957736435345 },
  { date: "2007-12-31", groundwater_cm: -3.0725045179590236 },
  { date: "2008-01-31", groundwater_cm: -1.1511774459111401 },
  { date: "2008-02-29", groundwater_cm: -1.5890012981249364 },
  { date: "2008-03-31", groundwater_cm: -0.9319585556889302 },
  { date: "2008-04-30", groundwater_cm: -3.2770425859972887 },
  { date: "2008-05-31", groundwater_cm: -3.94020806156403 },
  { date: "2008-06-30", groundwater_cm: -0.4309328611341064 },
  { date: "2008-07-31", groundwater_cm: 2.5918718754159524 },
  { date: "2008-08-31", groundwater_cm: -0.5114395935253572 },
  { date: "2008-09-30", groundwater_cm: -3.569646726255136 },
  { date: "2008-10-31", groundwater_cm: -4.407825440531386 },
  { date: "2008-11-30", groundwater_cm: -5.685106965115549 },
  { date: "2008-12-31", groundwater_cm: -3.7768018821821303 },
  { date: "2009-01-31", groundwater_cm: -2.3038567500553317 },
  { date: "2009-02-28", groundwater_cm: -1.0114458737539918 },
  { date: "2009-03-31", groundwater_cm: 0.5590713285733467 },
  { date: "2009-04-30", groundwater_cm: -0.2268539834751581 },
  { date: "2009-05-31", groundwater_cm: -3.5868735446882867 },
  { date: "2009-06-30", groundwater_cm: -3.301988129364219 },
  { date: "2009-07-31", groundwater_cm: -3.5430000760681915 },
  { date: "2009-08-31", groundwater_cm: -4.170214404522713 },
  { date: "2009-09-30", groundwater_cm: -7.090586537795437 },
  { date: "2009-10-31", groundwater_cm: -7.6616460159490245 },
  { date: "2009-11-30", groundwater_cm: -7.074112052087352 },
  { date: "2009-12-31", groundwater_cm: -5.963182211455265 },
  { date: "2010-01-31", groundwater_cm: -4.7270912189273036 },
  { date: "2010-02-28", groundwater_cm: -4.579712597582613 },
  { date: "2010-03-31", groundwater_cm: -6.16561065871185 },
  { date: "2010-04-30", groundwater_cm: -5.518545166584018 },
  { date: "2010-05-31", groundwater_cm: -5.370357310776395 },
  { date: "2010-06-30", groundwater_cm: -5.669517777147831 },
  { date: "2010-07-31", groundwater_cm: 1.1242051819968406 },
  { date: "2010-08-31", groundwater_cm: 0.6530464733049557 },
  { date: "2010-09-30", groundwater_cm: -1.299960235919641 },
  { date: "2010-10-31", groundwater_cm: -4.290265804684935 },
  { date: "2010-11-30", groundwater_cm: -3.7597312995474095 },
  { date: "2011-02-07", groundwater_cm: -0.8213976872923249 },
  { date: "2011-02-28", groundwater_cm: -1.0035814042845286 },
  { date: "2011-03-31", groundwater_cm: -1.2681352811830127 },
  { date: "2011-04-30", groundwater_cm: -3.9935217586756524 },
  { date: "2011-07-06", groundwater_cm: -3.016600282423504 },
  { date: "2011-07-31", groundwater_cm: -1.9266387470341202 },
  { date: "2011-08-31", groundwater_cm: 2.0518786841431247 },
  { date: "2011-09-30", groundwater_cm: -1.5139826232665206 },
  { date: "2011-10-16", groundwater_cm: -1.893572567291295 },
  { date: "2011-12-18", groundwater_cm: -4.56633322869938 },
  { date: "2011-12-31", groundwater_cm: -3.7823882194911045 },
  { date: "2012-01-31", groundwater_cm: -2.8559877921965757 },
  { date: "2012-02-29", groundwater_cm: -0.7486890294513279 },
  { date: "2012-03-31", groundwater_cm: -2.936193101662576 },
  { date: "2012-05-31", groundwater_cm: -6.9296001773114 },
  { date: "2012-06-30", groundwater_cm: -6.525232132491529 },
  { date: "2012-07-31", groundwater_cm: -3.916146192674352 },
  { date: "2012-08-31", groundwater_cm: -1.202381456384416 },
  { date: "2012-11-08", groundwater_cm: -6.256732809300775 },
  { date: "2012-11-30", groundwater_cm: -7.7399046045993956 },
  { date: "2012-12-31", groundwater_cm: -5.1427149765415185 },
  { date: "2013-01-31", groundwater_cm: -4.705150809228413 },
  { date: "2013-04-11", groundwater_cm: -3.031269695071177 },
  { date: "2013-04-30", groundwater_cm: -5.297506167321283 },
  { date: "2013-05-31", groundwater_cm: -5.5565223439696805 },
  { date: "2013-06-30", groundwater_cm: -4.425556506406102 },
  { date: "2013-09-30", groundwater_cm: -4.971279410901683 },
  { date: "2013-10-31", groundwater_cm: -4.2714301058735105 },
  { date: "2013-11-30", groundwater_cm: -5.72035883394286 },
  { date: "2013-12-31", groundwater_cm: -5.7952668221773544 },
  { date: "2014-03-02", groundwater_cm: -4.751924284498791 },
  { date: "2014-03-31", groundwater_cm: -4.421089685410443 },
  { date: "2014-04-30", groundwater_cm: -3.482334357390882 },
  { date: "2014-05-31", groundwater_cm: -5.7257490897178025 },
  { date: "2014-07-31", groundwater_cm: -5.122134827281715 },
  { date: "2014-08-31", groundwater_cm: -4.871943981769497 },
  { date: "2014-09-30", groundwater_cm: -5.820559877743995 },
  { date: "2014-10-31", groundwater_cm: -7.568125216710801 },
  { date: "2015-01-12", groundwater_cm: -9.206333483909958 },
  { date: "2015-01-31", groundwater_cm: -9.562592811455342 },
  { date: "2015-02-28", groundwater_cm: -5.3521526416599725 },
  { date: "2015-03-31", groundwater_cm: -3.5865349801086035 },
  { date: "2015-04-11", groundwater_cm: -4.398072092852439 },
  { date: "2015-06-28", groundwater_cm: -0.01516353728083296 },
  { date: "2015-07-31", groundwater_cm: -0.47600675175410084 },
  { date: "2015-08-31", groundwater_cm: -2.777094749941509 },
  { date: "2015-12-10", groundwater_cm: -9.071041452025357 },
  { date: "2016-01-03", groundwater_cm: -8.65874532126405 },
  { date: "2016-01-28", groundwater_cm: -7.937450451012359 },
  { date: "2016-02-29", groundwater_cm: -6.1505392212623535 },
  { date: "2016-05-08", groundwater_cm: -4.23215358120684 },
  { date: "2016-05-31", groundwater_cm: -7.309258743378301 },
  { date: "2016-06-30", groundwater_cm: -6.829327871943766 },
  { date: "2016-08-07", groundwater_cm: -1.9680983050845136 },
  { date: "2016-11-13", groundwater_cm: -11.16232723060661 },
  { date: "2016-12-10", groundwater_cm: -14.306798191379029 },
  { date: "2017-01-06", groundwater_cm: -9.527825366696883 },
  { date: "2017-03-16", groundwater_cm: -5.1400037609048255 },
  { date: "2017-04-09", groundwater_cm: -7.786680534337866 },
  { date: "2017-05-01", groundwater_cm: -8.863997300111002 },
  { date: "2017-05-22", groundwater_cm: -8.727905291100553 }
];

// src/data/gldas-data.ts
var gldasData = [
  { date: "2018-01-15", groundwater_cm: 242.72560958228482, year: 2018, month: 1 },
  { date: "2018-02-15", groundwater_cm: 241.75090598549488, year: 2018, month: 2 },
  { date: "2018-03-15", groundwater_cm: 244.2691754126007, year: 2018, month: 3 },
  { date: "2018-04-15", groundwater_cm: 245.56216485675554, year: 2018, month: 4 },
  { date: "2018-05-15", groundwater_cm: 246.26446921231664, year: 2018, month: 5 },
  { date: "2018-06-15", groundwater_cm: 245.02240581316974, year: 2018, month: 6 },
  { date: "2018-07-15", groundwater_cm: 248.19827299441212, year: 2018, month: 7 },
  { date: "2018-08-15", groundwater_cm: 254.96138110227582, year: 2018, month: 8 },
  { date: "2018-09-15", groundwater_cm: 254.71285251761014, year: 2018, month: 9 },
  { date: "2018-10-15", groundwater_cm: 248.94915861752435, year: 2018, month: 10 },
  { date: "2018-11-15", groundwater_cm: 244.53662891056823, year: 2018, month: 11 },
  { date: "2018-12-15", groundwater_cm: 242.1259745320422, year: 2018, month: 12 },
  { date: "2019-01-15", groundwater_cm: 240.58566308932234, year: 2019, month: 1 },
  { date: "2019-02-15", groundwater_cm: 242.11415176557352, year: 2019, month: 2 },
  { date: "2019-03-15", groundwater_cm: 248.19070344455628, year: 2019, month: 3 },
  { date: "2019-04-15", groundwater_cm: 253.2055454134619, year: 2019, month: 4 },
  { date: "2019-05-15", groundwater_cm: 253.41409392825366, year: 2019, month: 5 },
  { date: "2019-06-15", groundwater_cm: 251.58221330774035, year: 2019, month: 6 },
  { date: "2019-07-15", groundwater_cm: 251.61747926026223, year: 2019, month: 7 },
  { date: "2019-08-15", groundwater_cm: 262.5212120002374, year: 2019, month: 8 },
  { date: "2019-09-15", groundwater_cm: 263.47140373923327, year: 2019, month: 9 },
  { date: "2019-10-15", groundwater_cm: 259.32924466023496, year: 2019, month: 10 },
  { date: "2019-11-15", groundwater_cm: 254.1523154725911, year: 2019, month: 11 },
  { date: "2019-12-15", groundwater_cm: 252.09271410397469, year: 2019, month: 12 },
  { date: "2020-01-15", groundwater_cm: 255.165384926091, year: 2020, month: 1 },
  { date: "2020-02-15", groundwater_cm: 255.5156364338498, year: 2020, month: 2 },
  { date: "2020-03-15", groundwater_cm: 255.55790050921976, year: 2020, month: 3 },
  { date: "2020-04-15", groundwater_cm: 260.25608511383996, year: 2020, month: 4 },
  { date: "2020-05-15", groundwater_cm: 261.5525556466432, year: 2020, month: 5 },
  { date: "2020-06-15", groundwater_cm: 258.60570644958835, year: 2020, month: 6 },
  { date: "2020-07-15", groundwater_cm: 256.1142813948914, year: 2020, month: 7 },
  { date: "2020-08-15", groundwater_cm: 264.5472403138439, year: 2020, month: 8 },
  { date: "2020-09-15", groundwater_cm: 271.69653630129585, year: 2020, month: 9 },
  { date: "2020-10-15", groundwater_cm: 262.97012487554156, year: 2020, month: 10 },
  { date: "2020-11-15", groundwater_cm: 258.1178089897938, year: 2020, month: 11 },
  { date: "2020-12-15", groundwater_cm: 256.011269941559, year: 2020, month: 12 },
  { date: "2021-01-15", groundwater_cm: 253.96805388250152, year: 2021, month: 1 },
  { date: "2021-02-15", groundwater_cm: 252.06771787439087, year: 2021, month: 2 },
  { date: "2021-03-15", groundwater_cm: 251.04681533407967, year: 2021, month: 3 },
  { date: "2021-04-15", groundwater_cm: 250.33471923998223, year: 2021, month: 4 },
  { date: "2021-05-15", groundwater_cm: 249.41892305272253, year: 2021, month: 5 },
  { date: "2021-06-15", groundwater_cm: 248.44867958007714, year: 2021, month: 6 },
  { date: "2021-07-15", groundwater_cm: 247.79099348238086, year: 2021, month: 7 },
  { date: "2021-08-15", groundwater_cm: 255.6403522328084, year: 2021, month: 8 },
  { date: "2021-09-15", groundwater_cm: 259.4657823834525, year: 2021, month: 9 },
  { date: "2021-10-15", groundwater_cm: 257.5103971318112, year: 2021, month: 10 },
  { date: "2021-11-15", groundwater_cm: 252.7496016632109, year: 2021, month: 11 },
  { date: "2021-12-15", groundwater_cm: 248.60803195012886, year: 2021, month: 12 },
  { date: "2022-01-15", groundwater_cm: 248.46464216312714, year: 2022, month: 1 },
  { date: "2022-02-15", groundwater_cm: 249.44827102880188, year: 2022, month: 2 },
  { date: "2022-03-15", groundwater_cm: 248.62099403979823, year: 2022, month: 3 },
  { date: "2022-04-15", groundwater_cm: 247.51561398401233, year: 2022, month: 4 },
  { date: "2022-05-15", groundwater_cm: 245.832917316078, year: 2022, month: 5 },
  { date: "2022-06-15", groundwater_cm: 244.39961006905375, year: 2022, month: 6 },
  { date: "2022-07-15", groundwater_cm: 256.0862579482759, year: 2022, month: 7 },
  { date: "2022-08-15", groundwater_cm: 283.0249605257459, year: 2022, month: 8 },
  { date: "2022-09-15", groundwater_cm: 280.1122604852647, year: 2022, month: 9 },
  { date: "2022-10-15", groundwater_cm: 271.51915293022154, year: 2022, month: 10 },
  { date: "2022-11-15", groundwater_cm: 263.313148711739, year: 2022, month: 11 },
  { date: "2022-12-15", groundwater_cm: 257.9851659590588, year: 2022, month: 12 },
  { date: "2023-01-15", groundwater_cm: 254.2179427758698, year: 2023, month: 1 },
  { date: "2023-02-15", groundwater_cm: 252.16884543350974, year: 2023, month: 2 },
  { date: "2023-03-15", groundwater_cm: 251.10803820358825, year: 2023, month: 3 },
  { date: "2023-04-15", groundwater_cm: 251.18420683129963, year: 2023, month: 4 },
  { date: "2023-05-15", groundwater_cm: 250.38026021497174, year: 2023, month: 5 },
  { date: "2023-06-15", groundwater_cm: 250.50372162460206, year: 2023, month: 6 },
  { date: "2023-07-15", groundwater_cm: 262.9990228756361, year: 2023, month: 7 },
  { date: "2023-08-15", groundwater_cm: 274.72771912570994, year: 2023, month: 8 },
  { date: "2023-09-15", groundwater_cm: 267.0873136082674, year: 2023, month: 9 },
  { date: "2023-10-15", groundwater_cm: 260.3180277624548, year: 2023, month: 10 },
  { date: "2023-11-15", groundwater_cm: 254.54226379130918, year: 2023, month: 11 },
  { date: "2023-12-15", groundwater_cm: 250.78690799751507, year: 2023, month: 12 },
  { date: "2024-01-15", groundwater_cm: 247.97886125004428, year: 2024, month: 1 },
  { date: "2024-02-15", groundwater_cm: 246.3781246366567, year: 2024, month: 2 },
  { date: "2024-03-15", groundwater_cm: 246.8439260158686, year: 2024, month: 3 },
  { date: "2024-04-15", groundwater_cm: 249.87338345433872, year: 2024, month: 4 },
  { date: "2024-05-15", groundwater_cm: 252.8860482482843, year: 2024, month: 5 },
  { date: "2024-06-15", groundwater_cm: 251.1493385633252, year: 2024, month: 6 },
  { date: "2024-07-15", groundwater_cm: 252.12852966402494, year: 2024, month: 7 },
  { date: "2024-08-15", groundwater_cm: 270.95178535114854, year: 2024, month: 8 },
  { date: "2024-09-15", groundwater_cm: 277.13333089537224, year: 2024, month: 9 },
  { date: "2024-10-15", groundwater_cm: 265.27505541854094, year: 2024, month: 10 },
  { date: "2024-11-15", groundwater_cm: 257.39029780182034, year: 2024, month: 11 },
  { date: "2024-12-15", groundwater_cm: 253.02315027536835, year: 2024, month: 12 }
];

// src/index.ts
var corsHeaders = {
  "Access-Control-Allow-Origin": "*",
  "Access-Control-Allow-Methods": "GET, POST, OPTIONS",
  "Access-Control-Allow-Headers": "Content-Type"
};
function jsonResponse(data, status = 200) {
  return new Response(JSON.stringify(data), {
    status,
    headers: {
      "Content-Type": "application/json",
      ...corsHeaders
    }
  });
}
__name(jsonResponse, "jsonResponse");
function calculateStats(data) {
  const mean = data.reduce((a, b) => a + b, 0) / data.length;
  const min = Math.min(...data);
  const max = Math.max(...data);
  return { mean, min, max };
}
__name(calculateStats, "calculateStats");
function calculateTrend(data) {
  const n = data.length;
  if (n === 0)
    return { slope: 0, intercept: 0 };
  const firstDate = new Date(data[0].date).getTime();
  const x = data.map((d) => (new Date(d.date).getTime() - firstDate) / (1e3 * 60 * 60 * 24));
  const y = data.map((d) => d.value);
  const sumX = x.reduce((a, b) => a + b, 0);
  const sumY = y.reduce((a, b) => a + b, 0);
  const sumXY = x.reduce((acc, xi, i) => acc + xi * y[i], 0);
  const sumX2 = x.reduce((acc, xi) => acc + xi * xi, 0);
  const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
  const intercept = (sumY - slope * sumX) / n;
  const annualTrend = slope * 365.25;
  return { slope: annualTrend, intercept };
}
__name(calculateTrend, "calculateTrend");
var src_default = {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);
    const path = url.pathname;
    if (request.method === "OPTIONS") {
      return new Response(null, { headers: corsHeaders });
    }
    switch (path) {
      case "/":
        return jsonResponse({
          message: "WaterTrace API - Cloudflare Workers Edition",
          version: "2.0",
          endpoints: [
            "/api/health",
            "/api/historical/timeseries",
            "/api/recent/timeseries",
            "/api/gldas/trend-analysis",
            "/api/analysis/summary",
            "/api/combined/timeline",
            "/api/districts/groundwater",
            "/api/predict"
          ]
        });
      case "/api/health":
        return jsonResponse({ status: "healthy", timestamp: (/* @__PURE__ */ new Date()).toISOString() });
      case "/api/historical/timeseries":
        const graceValues = graceData.map((d) => d.groundwater_cm);
        const graceStats = calculateStats(graceValues);
        return jsonResponse({
          data: graceData,
          summary: {
            period: "2002-2017",
            data_source: "GRACE satellite",
            total_records: graceData.length,
            statistics: graceStats,
            unit: "cm"
          }
        });
      case "/api/recent/timeseries":
        const gldasBaseline = gldasData.slice(0, 12).reduce((acc, d) => acc + d.groundwater_cm, 0) / 12;
        const gldasWithAnomaly = gldasData.map((d) => ({
          ...d,
          groundwater_anomaly_cm: d.groundwater_cm - gldasBaseline
        }));
        return jsonResponse({
          data: gldasWithAnomaly,
          summary: {
            period: "2018-2024",
            data_source: "GLDAS model",
            total_records: gldasData.length,
            baseline_value: gldasBaseline,
            unit: "kg/m\xB2"
          }
        });
      case "/api/gldas/trend-analysis":
        const gldasTrendData = gldasData.map((d) => ({
          date: d.date,
          value: d.groundwater_cm
        }));
        const trend = calculateTrend(gldasTrendData);
        const yearlyAverages = {};
        gldasData.forEach((d) => {
          if (!yearlyAverages[d.year]) {
            yearlyAverages[d.year] = 0;
          }
          yearlyAverages[d.year] += d.groundwater_cm;
        });
        Object.keys(yearlyAverages).forEach((year) => {
          const count = gldasData.filter((d) => d.year === parseInt(year)).length;
          yearlyAverages[parseInt(year)] /= count;
        });
        return jsonResponse({
          trend: {
            annual_change_kg_m2: trend.slope,
            direction: trend.slope > 0 ? "increasing" : "decreasing",
            confidence: "medium"
          },
          yearly_averages: yearlyAverages,
          period: "2018-2024",
          methodology: "Linear regression on GLDAS soil moisture data"
        });
      case "/api/analysis/summary":
        return jsonResponse({
          project: "WaterTrace - Pakistan Groundwater Monitoring",
          description: "Comprehensive groundwater depletion analysis using satellite data",
          key_findings: {
            historical_loss: {
              value: -13.71,
              unit: "cm",
              period: "2002-2017",
              annual_rate: -0.81
            },
            recent_trend: {
              value: 1.5,
              unit: "kg/m\xB2/year",
              period: "2018-2024",
              interpretation: "Slight improvement"
            }
          },
          data_sources: {
            historical: "GRACE satellite (2002-2017)",
            recent: "GLDAS model (2018-2024)"
          },
          coverage: "145 districts across Pakistan"
        });
      case "/api/combined/timeline":
        const scalingFactor = -0.1;
        const gldasScaled = gldasData.map((d) => ({
          date: d.date,
          groundwater_cm: (d.groundwater_cm - 250) * scalingFactor,
          data_source: "GLDAS",
          scaled: true
        }));
        const combined = [
          ...graceData.map((d) => ({ ...d, data_source: "GRACE", scaled: false })),
          ...gldasScaled
        ].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
        return jsonResponse({
          data: combined,
          metadata: {
            grace_period: "2002-2017",
            gldas_period: "2018-2024",
            scaling_method: "Linear transformation",
            scaling_factor: scalingFactor
          }
        });
      case "/api/districts/groundwater":
        const districts = [
          { name: "Lahore", province: "Punjab", groundwater_level: -12.5, trend: "declining" },
          { name: "Karachi", province: "Sindh", groundwater_level: -8.3, trend: "stable" },
          { name: "Quetta", province: "Balochistan", groundwater_level: -15.3, trend: "critical" },
          { name: "Peshawar", province: "Khyber Pakhtunkhwa", groundwater_level: -6.7, trend: "improving" },
          { name: "Islamabad", province: "Federal", groundwater_level: -4.2, trend: "stable" }
        ];
        return jsonResponse({
          districts,
          summary: {
            total_districts: 145,
            data_shown: 5,
            most_affected: "Quetta",
            average_depletion: -9.4,
            critical_districts: 3,
            average_change: -9.4,
            improving_districts: 1
          }
        });
      case "/api/predict":
        if (request.method !== "POST") {
          return jsonResponse({ error: "Method not allowed" }, 405);
        }
        try {
          const body = await request.json();
          const years = body.years || 5;
          const recentTrend = -0.81;
          const lastValue = graceData[graceData.length - 1].groundwater_cm;
          const predictions = [];
          for (let i = 1; i <= years; i++) {
            predictions.push({
              year: 2017 + i,
              predicted_groundwater_cm: lastValue + recentTrend * i,
              confidence: "medium",
              method: "Linear extrapolation"
            });
          }
          return jsonResponse({
            predictions,
            parameters: {
              base_year: 2017,
              trend_rate: recentTrend,
              years_predicted: years
            }
          });
        } catch (error) {
          return jsonResponse({ error: "Invalid request body" }, 400);
        }
      default:
        return jsonResponse({ error: "Not found" }, 404);
    }
  }
};
export {
  src_default as default
};
//# sourceMappingURL=index.js.map
